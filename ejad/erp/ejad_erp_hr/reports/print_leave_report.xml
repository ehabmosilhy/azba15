<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_hr_leaves">
        <t t-call="web.html_container">
            <t t-call="web.internal_layout">
                <link rel="stylesheet" href="/ejad_erp_hr/static/src/scss/report.css"/>
                <!-- Start charter Report Header -->
                <t t-foreach="docs.sudo()" t-as="o">
                    <div class="charter-page">
                        <!-- Start Charter Report Header -->
                    </div>

                    <!-- Start Completion Certificates Report Content -->
                    <section class="charter-content financial-content detailed-content report-content">
                        <div class="container-fluid">
                            <div class="charter-page">
                                <!-- Start Charter Report Header -->
                                <section class="charter-header">
                                    <header>
                                        <div class="container-fluid">
                                            <div class="row">
                                                <div class="col-6">
<!--                                                    <img src="/ejad_erp_hr/static/src/img/report/VRO-logo.png"-->
<!--                                                         class="img-fluid"-->
<!--                                                         width="150px" alt="VRO Logo"/>-->
                                                </div>
                                                <div class="col-6 text-right">
<!--                                                    <img src="/ejad_erp_hr/static/src/img/report/vision.png"-->
<!--                                                         class="img-fluid"-->
<!--                                                         width="100px" alt="VRO Logo"/>-->
                                                </div>
                                            </div> <!-- End Row -->
                                        </div> <!-- End Container -->
                                    </header> <!-- End Header -->
                                </section> <!-- End Charter Report Header -->
                                <section class="report-tables">
                                    <div class="title risk-table">
                                          <div class="title risk-table text-center">
                                                <h2>نموذج طلب أجازة</h2>
                                            </div>
                                        <h2>بيانات الموظف</h2>

                                        <table class="table">
                                            <tr>
                                                <th class="cell-title">
                                                    <span>اسم الموظف</span>
                                                </th>
                                                <td>
                                                    <span t-esc="o.employee_id.name"/>
                                                </td>
                                                <th class="cell-title">
                                                    <span>الإدارة/القسم</span>
                                                </th>
                                                <td>
                                                    <span t-esc="o.employee_id.department_id.name"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th class="cell-title">
                                                    <span>الوظيفة</span>
                                                </th>
                                                <td>
                                                    <span t-esc="o.employee_id.job_id.name"/>
                                                </td>
                                                <th class="cell-title">
                                                    <span>تاريخ التعيين</span>
                                                </th>
                                                <td>
                                                    <span t-field="o.employee_id.hiring_date" t-options='{"format": "d MMM Y"}'/>
                                                </td>
                                            </tr>
                                              <tr>
                                                <th class="cell-title">
                                                    <span>تاريخ الطلب</span>
                                                </th>
                                                <td>
                                                    <span t-field="o.create_date" t-options='{"format": "d MMM Y"}'/>
                                                </td>
                                                <th class="cell-title">
                                                    <span>تاريخ اخر أجازة</span>
                                                </th>
                                                <td>
                                                    <span t-esc="o.get_last_holidays(o.employee_id.id)"/>
                                                </td>
                                            </tr>
                                        </table>

                                    </div>
                                    <div class="title risk-table">
                                        <h2>بيانات الإجازة</h2>
                                       <table class="table">
                                            <tr>
                                                <th rowspan="2" class="cell-title">
                                                    <span>نوع الإجازة</span>
                                                </th>
                                                <td rowspan="2">
                                                    <span t-esc="o.holiday_status_id.name"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th class="cell-title">
                                                    <span>من يوم</span>
                                                </th>
                                                <td>
                                                    <span t-esc="o.get_date_to_dayinweek(o.request_date_from)"/>
                                                </td>
                                                <th class="cell-title">
                                                    <span>بتاريخ</span>
                                                </th>
                                                <td>
                                                    <span t-field="o.request_date_from" t-options='{"format": "d MMM Y"}'/>
                                                </td>
                                                 <th class="cell-title">
                                                    <span>الايام المطلوبة</span>
                                                </th>
                                                 <td>
                                                    <span t-esc="o.number_of_days"/>
                                                </td>
                                            </tr>
                                             <tr>
                                                <th class="cell-title">
                                                    <span>إلى يوم</span>
                                                </th>
                                                <td>
                                                    <span t-esc="o.get_date_to_dayinweek(o.request_date_to)"/>
                                                </td>
                                                <th class="cell-title">
                                                    <span>بتاريخ</span>
                                                </th>
                                                <td>
                                                    <span t-field="o.request_date_to" t-options='{"format": "d MMM Y"}'/>
                                                </td>
                                            </tr>
                                        </table>
                                        <table class="table">
                                                <tr>
                                                    <th rowspan="2" class="cell-title">
                                                        <span>الموظف البديل</span>
                                                    </th>
                                                    <th class="cell-title">
                                                        <span> الأسم</span>
                                                    </th>
                                                     <td>
                                                        <span t-esc="o.replaced_employee_id.name"/>
                                                    </td>
                                                      <th class="cell-title">
                                                        <span>الرئيس المباشر</span>
                                                    </th>
                                                    <t t-if="o.state == 'validate'">
                                                          <th class="cell-title">
                                                            <span> أوافق</span>
                                                         </th>
                                                    </t>
                                                   <t t-elif="o.state == 'refuse'">
                                                    <th class="cell-title">
                                                        <span>لا أوافق</span>
                                                    </th>
                                                   </t>
                                                    <t t-else="">
                                                    <th class="cell-title">
                                                        <span>لم تتم الموافقة النهائية</span>
                                                    </th>
                                                   </t>
                                                </tr>
                                                <tr>
                                                    <th class="cell-title">
                                                        <span>التوقيع</span>
                                                    </th>
                                                    <td>
                                                        <img t-if="o.replaced_employee_id.user_id.digital_signature"
                                                                 t-att-src="image_data_uri(o.replaced_employee_id.user_id.digital_signature)"
                                                                 style="width:75%;max-height: 50px;"/>

                                                    </td>
                                                     <th class="cell-title">
                                                        <span>وذلك بسبب :</span>
                                                    </th>
                                                    <td>
                                                        <t t-foreach="o.sudo().message_ids.sorted(lambda line: line.id , reverse=True)" t-as="message">
                                                        <t t-foreach="message.sudo().tracking_value_ids.filtered(lambda m: m.field=='state' and m.old_value_char == 'المدير المباشر')"
                                                            t-as="user">
                                                        <t t-if="user.new_value_char == 'مرفوض'">
                                                        <t t-foreach="o.sudo().message_ids.sorted(lambda line: line.id , reverse=True)" t-as="message2">
                                                            <t t-foreach="message2.sudo().tracking_value_ids.filtered(lambda m: m.field=='refuse_message' and m.new_value_text)"
                                                                t-as="line">

                                                              <span t-esc="line.new_value_text"/>
                                                            </t>
                                                            </t>
                                                            </t>
                                                         </t>
                                                         </t>
                                                    </td>
                                                </tr>
                                            <tr>
                                                <th rowspan="2" class="cell-title">
                                                    <span>الموظف</span>
                                                </th>
                                                <th class="cell-title">
                                                    <span> الأسم</span>
                                                </th>
                                                 <td>
                                                    <span t-esc="o.employee_id.name"/>
                                                </td>
                                                 <th class="cell-title">
                                                    <span> الأسم</span>
                                                </th>
                                                 <td>
                                                     <span t-esc="o.employee_id.parent_id.name"/>
                                                </td>

                                            </tr>
                                            <tr>
                                                <th class="cell-title">
                                                    <span>التوقيع</span>
                                                </th>
                                                <td>
                                                     <img t-if="o.employee_id.user_id.digital_signature"
                                                                 t-att-src="image_data_uri(o.employee_id.user_id.digital_signature)"
                                                                 style="width:75%;max-height: 50px;"/>
                                                </td>
                                                 <th class="cell-title">
                                                    <span>التوقيع</span>
                                                </th>
                                                <td>
                                                     <img t-if="o.employee_id.parent_id.user_id.digital_signature"
                                                                 t-att-src="image_data_uri(o.employee_id.parent_id.user_id.digital_signature)"
                                                                 style="width:75%;max-height: 50px;"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>

                                </section>
                            </div>

                        </div> <!-- End Container -->
                    </section> <!-- End Report Content -->
                    <section class="charter-content financial-content detailed-content report-content">
                           <section class="report-tables">
                              <div class="title risk-table">
                                            <t t-set="balance" t-value="o.holiday_status_id.get_days(o.employee_id.id)[o.holiday_status_id.id]['virtual_remaining_leaves']"/>
                                             <h2>خاص بالشؤون الإدارية والمالية </h2>
                                                <table class="table">
                                                    <tr>
                                                        <th colspan="6" class="cell-title">
                                                            <span>الأيام المستحقة حتى بدء الأجازة </span>
                                                        </th>
                                                         <th colspan="3" class="cell-title">
                                                            <span>إعتماد صاحب الصلاحية</span>
                                                        </th>
                                                        <t t-if="o.state == 'validate'">
                                                            <th colspan="3" class="cell-title">
                                                                <span> تعتمد</span>
                                                            </th>
                                                        </t>
                                                          <t t-elif="o.state == 'refuse'">
                                                            <th colspan="3" class="cell-title">
                                                                <span>لا تعتمد</span>
                                                            </th>
                                                          </t>
                                                        <t t-else="">
                                                            <th colspan="3" class="cell-title">
                                                                <span>لم يكتمل الاعتماد</span>
                                                            </th>
                                                        </t>
                                                    </tr>
                                                    <tr>
                                                        <th class="cell-title">
                                                            <span>الرصيد</span>
                                                        </th>
                                                        <td>
                                                           <span t-esc="o.holiday_status_id.get_days(o.employee_id.id)[o.holiday_status_id.id]['virtual_remaining_leaves']"/>
                                                        </td>
                                                        <th class="cell-title">
                                                            <span> الأيام المطلوبة</span>
                                                        </th>
                                                          <td>
                                                             <span t-esc="o.number_of_days"/>
                                                        </td>
                                                          <t t-if="balance >= o.number_of_days">
                                                              <th class="cell-title">
                                                                <span>كافى</span>
                                                              </th>
                                                          </t>
                                                          <t t-else="balance &lt; o.number_of_days">
                                                              <th class="cell-title">
                                                                <span>غير كافى</span>
                                                               </th>
                                                          </t>
                                                         <th colspan="6" class="cell-title">
                                                            <span>وذلك بسبب :</span>
                                                        </th>
                                                    </tr>
                                                    <tr>
                                                        <th class="cell-title">
                                                            <span>الملاحظات</span>
                                                        </th>
                                                        <td colspan="5">
                                                            <span t-esc="o.report_note"/>
                                                        </td>
                                                        <td colspan="6">
                                                            <t t-foreach="o.sudo().message_ids.sorted(lambda line: line.id , reverse=True)" t-as="message">
                                                            <t t-foreach="message.sudo().tracking_value_ids.filtered(lambda m: m.field=='state' and m.old_value_char == 'قائد المكتب')"  t-as="user">
                                                            <t t-if="user.new_value_char == 'مرفوض'">
                                                                  <t t-foreach="o.sudo().message_ids.sorted(lambda line: line.id , reverse=True)" t-as="message2">
                                                                  <t t-foreach="message2.sudo().tracking_value_ids.filtered(lambda m: m.field=='refuse_message' and m.new_value_text)"
                                                                   t-as="line">
                                                                    <span t-esc="line.new_value_text"/>
                                                                </t>
                                                                </t>
                                                            </t>
                                                            </t>
                                                            </t>
                                                        </td>
                                                     </tr>
                                                      <tr>
                                                        <th colspan="2" class="cell-title">
                                                            <span>هل تم التسجيل ؟</span>
                                                        </th>
                                                        <th colspan="2">
                                                            <span>نعم</span>
                                                        </th>
                                                        <th colspan="2">
                                                            <span>لا</span>
                                                        </th>
                                                         <th class="cell-title">
                                                            <span>الوظيفة</span>
                                                        </th>
                                                        <td colspan="3">
                                                            <t t-foreach="o.sudo().message_ids.sorted(lambda line: line.id , reverse=True)" t-as="message">
                                                            <t t-foreach="message.sudo().tracking_value_ids.filtered(lambda m: m.field=='state' and m.old_value_char == 'قائد المكتب')"
                                                               t-as="line">
                                                             <span t-esc="line.old_value_char"/>
                                                            </t>
                                                           </t>
                                                        </td>
                                                     </tr>
                                                     <tr>
                                                        <th rowspan="2" class="cell-title">
                                                            <span>الموظف المختص</span>
                                                        </th>
                                                        <th class="cell-title">
                                                            <span> الأسم</span>
                                                        </th>
                                                          <td colspan="4">
                                                             <span t-esc="o.get_employee_spcail(1)"/>
                                                          </td>
                                                          <th class="cell-title">
                                                            <span> الأسم</span>
                                                        </th>
                                                        <td colspan="3">
                                                            <t t-foreach="o.sudo().message_ids.sorted(lambda line: line.id , reverse=True)" t-as="message">
                                                            <t t-foreach="message.sudo().tracking_value_ids.filtered(lambda m: m.field=='state' and m.old_value_char == 'قائد المكتب')"
                                                              t-as="line">
                                                            <span t-esc="line.create_uid.name"/>
                                                            </t>
                                                            </t>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th class="cell-title">
                                                             <span>التوقيع</span>
                                                        </th>
                                                        <td colspan="3">
                                                            <img t-if="o.get_employee_spcail(2).digital_signature"
                                                                     t-att-src="image_data_uri(o.get_employee_spcail(2).digital_signature)"
                                                                     style="width:75%;max-height: 50px;"/>
                                                        </td>
                                                        <th colspan="3" class="cell-title">
                                                            <span>التوقيع</span>
                                                        </th>
                                                         <td colspan="3">
                                                               <t t-foreach="o.sudo().message_ids.sorted(lambda line: line.id, reverse=True)" t-as="message">
                                                                <t t-foreach="message.sudo().tracking_value_ids.filtered(lambda m: m.field=='state' and m.old_value_char == 'قائد المكتب')"
                                                                    t-as="line">
                                                               <img t-if="line.create_uid.digital_signature"
                                                                     t-att-src="image_data_uri(line.create_uid.digital_signature)"
                                                                     style="width:75%;max-height: 50px;"/>
                                                                </t>
                                                               </t>
                                                        </td>
                                                </tr>

                                            </table>
                                         </div>
                              <div class="title risk-table">
                                              <h2>تستعمل عند عودة الموظف من الاجازة الإعتيادية</h2>

                                              <table class="table">
                                                <tr>
                                                     <th colspan="4">
                                                        <span>السادة/ الشؤون الإدارية والمالية</span>
                                                    </th>
                                                    <th colspan="4">
                                                        <span>المحترمين</span>
                                                    </th>

                                               </tr>
                                              <tr>
                                                     <th colspan="8">
                                                        <span>نفيدكم بأن الموظف /ة الواردة بياناته /ها اعلاه قد باشر /ت العمل بعد تمتعة /هابالأجازة المطلوبة أعلاه.</span>
                                                    </th>
                                               </tr>
                                              <tr>
                                                     <th class="cell-title">
                                                            <span>اليوم</span>
                                                        </th>
                                                   <td>
                                                       <t t-if="o.leave_return_id">
                                                           <span t-esc="o.get_date_to_dayinweek(o.leave_return_id.request_return_date)"/>
                                                       </t>
                                                   </td>
                                                    <th class="cell-title">
                                                        <span> التاريخ</span>
                                                    </th>
                                                  <td>
                                                      <t t-if="o.leave_return_id">
                                                           <span t-esc="o.leave_return_id.request_return_date"/>
                                                      </t>
                                                  </td>

                                                    <th class="cell-title">
                                                        <span> الرئيس المباشر</span>
                                                    </th>
                                                  <td colspan="3">
                                                       <span t-esc="o.employee_id.parent_id.name"/>
                                                  </td>
                                               </tr>
                                              <tr>
                                                   <th class="cell-title">
                                                         <span> ملاحظات :</span>
                                                   </th>
                                                   <td colspan="3">
                                                       <t t-if="o.leave_return_id.action_type == 'add_allocation'">
                                                           تم إضافة رصيد <span t-field="o.leave_return_id.days_off_add"/> يوم وذلك لمباشرة العمل قبل انتهاء موعد الإجازة
                                                       </t>
                                                       <t t-elif="o.leave_return_id.action_type == 'remove_allocation'">
                                                         تم خصم رصيد <span t-field="o.leave_return_id.days_off_add"/> يوم وذلك لمباشرة العمل بعد انتهاء موعد الإجازة
                                                       </t>
                                                       <t t-elif="o.leave_return_id.action_type == 'no_action'">
                                                         <span t-field="o.leave_return_id.action_type"/>
                                                       </t>
                                                       <t t-else="">
                                                         <span t-field="o.leave_return_id.action_type"/>
                                                       </t>
                                                  </td>
                                                   <th class="cell-title">
                                                        <span>التوقيع</span>
                                                        </th>
                                                      <td colspan="3">
                                                          <img t-if="o.employee_id.parent_id.user_id.digital_signature"
                                                                     t-att-src="image_data_uri(o.employee_id.parent_id.user_id.digital_signature)"
                                                                     style="width:75%;max-height: 50px;"/>
                                                      </td>
                                              </tr>
                                          </table>
                                         </div>
                              <div class="title risk-table">
                                          <h2>الشؤون الإدارية والمالية</h2>

                                          <table class="table">
                                            <tr>
                                                <td colspan="4" rowspan="2">
                                                     <span>تمت مراجعة الإجراءات والتأكد من صحتها ومباشرة الموظف وتحديث السجلات والرواتب .</span>

                                                </td>
                                                  <th class="cell-title">
                                                    <span>الإسم</span>
                                                </th>
                                              <td colspan="4">
                                                     <span t-esc="o.get_employee_spcail(1)"/>
                                              </td>
                                            </tr>
                                           <tr>
                                                <th class="cell-title">
                                                    <span>التوقيع</span>
                                                </th>
                                              <td colspan="4">
                                                    <img t-if="o.get_employee_spcail(2).digital_signature"
                                                             t-att-src="image_data_uri(o.get_employee_spcail(2).digital_signature)"
                                                             style="width:75%;max-height: 50px;"/>
                                              </td>
                                           </tr>
                                          </table>
                                       </div>
                           </section>
                    </section>
                </t>
            </t>
        </t>
    </template>

    <record id="paperformat_leaves_report" model="report.paperformat">
        <field name="name">Time Off Summary</field>
        <field name="default" eval="True"/>
        <field name="format">custom</field>
        <field name="page_height">0</field>
        <field name="page_width">0</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">0</field>
        <field name="margin_bottom">0</field>
        <field name="margin_left">0</field>
        <field name="margin_right">0</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">20</field>
        <field name="dpi">90</field>
    </record>

    <report
            id="hr_leaves_report"
            string="تقرير الأجازات"
            model="hr.leave"
            report_type="qweb-pdf"
            name="ejad_erp_hr.report_hr_leaves"
            file="ejad_erp_hr.report_hr_leaves"
            print_report_name="'تقرير الأجازات'"
            paperformat="ejad_erp_hr.paperformat_leaves_report"/>
</odoo>
