<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record id="view_multi_partners_service_tree" model="ir.ui.view">
            <field name="name">multi.partners.service.tree</field>
            <field name="model">multi.partners.service</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="الخدمات" editable="top">
                    <field name="name" required="1"/>
                    <field name="account_id"/>

                    <field name="active"/>
                </tree>
            </field>
        </record>

        <record id="action_multi_partners_service" model="ir.actions.act_window">
            <field name="name">اعداد الخدمات</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">multi.partners.service</field>
            <!--<field name="view_type">form</field>-->
            <field name="view_mode">tree</field>
        </record>

        <record id="view_multi_partners_tree" model="ir.ui.view">
            <field name="name">partner.invoice.multi.tree</field>
            <field name="model">partner.invoice.multi</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="صاحب الاستحقاق">
                    <field name="name" required="1"/>
                    <field name="other_info"/>
                    <field name="bank_account_id"/>
                    <field name="active"/>
                </tree>
            </field>
        </record>

        <record id="view_multi_partners_form" model="ir.ui.view">
            <field name="name">partner.invoice.multi.form</field>
            <field name="model">partner.invoice.multi</field>
            <field name="arch" type="xml">

                <form string="صاحب الاستحقاق" editable="top">
                    <sheet>
                    <group>
                        <group>
                            <field name="name" required="1"/>
                            <field name="active"/>
                            <field name="supplier_id"/>
                        </group>
                        <group>
                            <field name="other_info"/>
                            <field name="bank_account_id"/>
                        </group>
                    </group>
                </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

    <record id="view_multi_partners_search" model="ir.ui.view">
            <field name="name">partner.invoice.multi.search</field>
            <field name="model">partner.invoice.multi</field>
            <field name="arch" type="xml">
            <search string="اصحاب الاستحقاق">
                <field name="name"/>
                <field name="other_info"/>
            </search>
        </field>
    </record>

        <record id="action_view_multi_partners_tree" model="ir.actions.act_window">
            <field name="name">اعداد اصحاب الاستحقاق</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">partner.invoice.multi</field>
            <!--<field name="view_type">form</field>-->
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_multi_partners_search"/>
        </record>

        <menuitem id="invoice_multi_partners_main_menu" name="مصروفات متعددة المستفيدين"
                  groups="ejad_erp_account.access_multi_partners_menu"
                  web_icon="ejad_erp_account,static/description/icon2.png"
                  sequence="100"/>
        <menuitem id="invoice_multi_partners_sub_menu" name="مصروفات متعددة المستفيدين"
                  groups="ejad_erp_account.access_multi_partners_menu"
                  sequence="5"
                  parent="invoice_multi_partners_main_menu"/>
        <menuitem id="multi_partners_service_menu" name="اعداد الخدمات"
                  groups="ejad_erp_account.access_multi_partners_setting_menu"
                  sequence="5"
                  parent="invoice_multi_partners_sub_menu" action="action_multi_partners_service"/>
        <menuitem id="multi_partners_menu" name="اعداد أصحاب الاستحقاق"
                  sequence="5"
                  parent="invoice_multi_partners_sub_menu" action="action_view_multi_partners_tree"/>

        <record id="view_account_invoice_multi_partners_tree" model="ir.ui.view">
            <field name="name">account.invoice.multi.partners.tree</field>
            <field name="model">account.invoice.multi.partners</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="مصروفات متعددة المستفيدين">
                    <field name="name"/>
                    <field name="date"/>
                    <field name="user_id"/>
                    <field name="service_id"/>
                    <field name="description"/>
                    <field name="journal_id"/>
                    <field name="total"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="view_account_invoice_multi_partners_form" model="ir.ui.view">
            <field name="name">account.invoice.multi.partners.form</field>
            <field name="model">account.invoice.multi.partners</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="مصروفات متعددة المستفيدين">
                    <header>
                        <field name="require_general_director_approve" invisible="1"/>
                        <button name="action_confirm" type="object" string="تأكيد"
                                groups="ejad_erp_account.group_invoice_multi_confirm"
                                class="oe_highlight" states="draft"/>
                        <button name="action_accountant" type="object" string="اعتماد مختص الحسابات"
                                groups="ejad_erp_account.group_invoice_multi_accountant"
                                class="oe_highlight" states="confirmed"/>
                        <button name="action_verification" type="object" string="اعتماد المدقق المالي"
                                groups="ejad_erp_account.group_invoice_multi_financial_auditor"
                                class="oe_highlight" states="accountant"/>
                        <button name="action_account_department" type="object" string="اعتماد المدير المالي"
                                groups="ejad_erp_account.group_invoice_multi_financial_manager"
                                class="oe_highlight" states="verification"/>
                        <button name="action_finance_monitor" type="object" string="اعتماد المراقب المالي"
                                groups="ejad_erp_account.group_invoice_multi_financial_monitor"
                                class="oe_highlight" states="account_department"/>
                        <button name="action_managerial" type="object"
                                string="اعتماد المشرف العام على الشئون الادارية و المالية" class="oe_highlight"
                                groups="ejad_erp_account.group_invoice_multi_admin_financial_manager"
                                states="finance_monitor"/>
                        <button name="button_general_director_approve"
                                attrs="{'invisible': ['|',
                                ('require_general_director_approve', '=', False),
                                ('state', '!=', 'managerial')]}"

                                string="موافقة الرئيس " type="object"
                                class="oe_highlight" groups="ejad_erp_base.group_general_director"/>

                        <button name="action_cancel" type="object" string="الغاء" class="oe_highlight"
                                groups="ejad_erp_account.group_invoice_multi_cancel"
                                states="draft,confirmed"/>
                        <button name="action_register_payment" type="object" string="تسجيل الدفعية" class="oe_highlight"
                                groups="ejad_erp_account.group_invoice_multi_register_payment"
                                attrs="{'invisible':['|', '&amp;',
                                ('require_general_director_approve', '=', True), ('state', '!=', 'general_director_approve'),
                                 '&amp;',
                                ('require_general_director_approve', '=', False), ('state', '!=', 'managerial')]}"
                        />
                        <button name="%(action_payment_order_report_wizard)d"
                                type="action"
                                string="طباعة أمر الصرف"
                                class="oe_stat_button oe_highlight"
                                attrs="{'invisible': [('move_id', '=', False)]}"
                                context="{
									'default_move_id': move_id,
									'default_payment_name': name,

								}"
                        />

                        <button name="%(action_bank_letter_multi_wizard)d"
                                type="action"
                                attrs="{'invisible':['|', '&amp;',
                                ('require_general_director_approve', '=', True), ('state', '=', 'managerial'),
                                ('state', 'not in', ['general_director_approve','paid','managerial'])]}"

                                groups="ejad_erp_account.group_print_bank_letter_multi"
                                string="خطاب البنك"
                                class="oe_stat_button oe_highlight"
                                context="{
									'default_invoice_id': active_id,
									'default_journal_id': payment_journal_id,
									'default_line_ids': line_ids,

								}"
                        />

                        <field name="state" widget="statusbar"
                               statusbar_visible="draft,confirmed,accountant,verification,account_department,finance_monitor,managerial,paid,cancel"/>
                    </header>
                    <sheet>
                        <h3>
                            <field name="name"/>
                        </h3>
                        <group>
                            <group>
                                <field name="user_id" readonly="1"/>
                                <field name="service_id" required="1"/>
                                <field name="description"/>
                                <field name="total"/>
                                <field name="payment_date" attrs="{'invisible':[('state','in',['draft','cancel'])]}"/>
                                <field name="move_id" readonly="1" attrs="{'invisible':[('state','not in',['paid'])]}"/>
                            </group>
                            <group>

                                <field name="date"/>

                                <field name="payment_type2"/>
                                <field name="journal_id" domain="[('type','=','purchase')]" invisible="1"/>
                                <field name="payment_journal_id" domain="[('type','in',['cash','bank'])]"
                                       widget="selection" attrs="{'invisible':[('state','in',['draft','cancel'])]}"/>
                                <field name="account_id" string="الحساب المدين"/>
                                <field name="journal_account_id" readonly="1"/>
                                <field name="bank_ref"/>
                                <field name="cash_ref_seq" invisible="1"/>
                                <field name="bank_ref_seq" invisible="1"/>
                                <field name="bank_check_no"/>

                            </group>
                        </group>
                        <notebook>
                            <page string="المصروفات">
                                <field name="line_ids" nolabel="1" context="{'default_name':description}">
                                    <tree editable="top">
                                        <field name="name"/>
                                        <field name="partner_id" domain="[('supplier_rank','>',0)]" invisible="1" required="0"/>
                                        <field name="partner_id2" required="1"/>
                                        <field name="acc_number"/>
                                        <field name="bank_id"/>
                                        <field name="amount" sum="total"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="action_account_invoice_multi_partners" model="ir.actions.act_window">
            <field name="name">مصروفات متعددة المستفيدين</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">account.invoice.multi.partners</field>
            <!--<field name="view_type">form</field>-->
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="menu_account_invoice_multi_partners"
                  name="مصروفات متعددة المستفيدين"
                  action="action_account_invoice_multi_partners"
                  parent="invoice_multi_partners_sub_menu"
                  groups="ejad_erp_account.access_multi_partners_menu"
                  sequence="3"/>
    </data>
</openerp>