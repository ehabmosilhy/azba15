<?xml version="1.0" encoding="utf-8"?>
<odoo>


    <!--<record model="ir.ui.view" id="invoice_tree_inherit">-->
    <!--<field name="name">account.invoice.inherit</field>-->
    <!--<field name="model">account.move</field>-->
    <!--<field name="inherit_id" ref="account.view_invoice_tree"/>-->
    <!--<field name="arch" type="xml">-->
    <!--<field name="invoice_date_due" position="replace">-->
    <!--<field name="invoice_date_due" force_save="1" placeholder="Date"-->
    <!--attrs="{'invisible': ['|', ('invoice_payment_term_id', '!=', False), ('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"/>-->

    <!--</field>-->
    <!--</field>-->
    <!--</record>-->

    <record id="view_account_invoice_filter_report_inherit" model="ir.ui.view">
        <field name="name">account.invoice.search.report</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter"/>
        <field name="arch" type="xml">
            <data>
                <xpath expr="//field[@name='journal_id']" position="after">
                    <field name="report" string="Report" invisible="context.get('move_type')=='out_invoice'"/>
                </xpath>
            </data>
        </field>
    </record>


    <record model="ir.ui.view" id="account_invoice_inherit">
        <field name="name">account.invoice.inherit</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="is_pay_by_custody"

                       attrs="{'invisible':[('move_type', '!=', 'in_invoice')],'readonly':[('state', 'not in', ['draft','accountant_approval'])]}"/>
                <field name="custody_partner_id"
                       attrs="{'readonly':[('state', 'not in', ['draft','accountant_approval'])], 'invisible':[('is_pay_by_custody', '!=', True)]}"/>
            </xpath>

            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="options">{
                    "no_create": True,
                    }
                </attribute>

            </xpath>
            <!--<xpath expr="//field[@name='state']" position="replace">-->
            <!--<field name="state" widget="statusbar" statusbar_visible="draft,accountant_approval,open,paid"/>-->
            <!--</xpath>-->
            <xpath expr="//field[@name='team_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='state']" position="before">
                <field name="is_total_amount_exceed_limit" invisible="1"/>
                <button name="action_accountant" string="موافقة الأخصائي المالي" type="object"
                        attrs="{'invisible': ['|','|',('out_invoice_not_exceed_limit_state', '!=', 'accountant'),('is_total_amount_exceed_limit', '=', True),('move_type','!=','out_invoice')]}"
                        groups="ejad_erp_account.group_financial_specialist" class="oe_highlight"/>

                <button name="action_direct_purchase_procurements_unit" string="موافقة مسؤول المشتريات" type="object"
                        attrs="{'invisible': ['|','|',('out_invoice_not_exceed_limit_state', '!=', 'procurements_unit'),('is_total_amount_exceed_limit', '=', True),('move_type','!=','out_invoice')]}"
                        groups="ejad_erp_account.purchase_requisition_procurements_unit" class="oe_highlight"/>

                <button name="action_executive_authority" string="موافقة الجهة المنفذة" type="object"
                        attrs="{'invisible': ['|','|',('out_invoice_exceed_limit_state', '!=', 'executive_authority'),('is_total_amount_exceed_limit', '=', False),('move_type','!=','out_invoice')]}"
                        groups="ejad_erp_account.group_executive_authority" class="oe_highlight"/>
                <button name="action_departments_manager" string="موافقة مدراء الوحدات الإدارية" type="object"
                        attrs="{'invisible': ['|','|',('out_invoice_exceed_limit_state', '!=', 'departments_manager'),('is_total_amount_exceed_limit', '=', False),('move_type','!=','out_invoice')]}"
                        groups="ejad_erp_account.group_executive_authority" class="oe_highlight"/>

                <button name="action_support_services_manager" string="موافقة مدير إدارة الخدمات المساندة" type="object"
                        attrs="{'invisible': ['&amp;',('out_invoice_exceed_limit_state', '!=', 'support_services_manager'),('out_invoice_not_exceed_limit_state', '!=', 'support_services_manager')]}"
                        groups="ejad_erp_account.group_support_services_manage" class="oe_highlight"/>

                <button name="action_office_leader" string="موافقة قائد المكتب" type="object"
                        attrs="{'invisible': ['&amp;',('out_invoice_exceed_limit_state', '!=', 'office_leader'),('out_invoice_not_exceed_limit_state', '!=', 'office_leader')]}"
                        groups="ejad_erp_account.group_office_leader" class="oe_highlight"/>

<!--                <button name="action_refused_direct_purchase" string="رفض" type="object"-->
<!--                        attrs="{'invisible': ['|',('out_invoice_not_exceed_limit_state', 'in', ['accepted','refused']),('out_invoice_exceed_limit_state', 'in', ['accepted','refused'])]}"-->
<!--                        groups="ejad_erp_account.group_executive_authority,ejad_erp_account.group_support_services_manage,ejad_erp_account.purchase_requisition_procurements_unit,ةejad_erp_account.group_financial_specialist,ejad_erp_account.purchase_office_leader,ejad_erp_account.purchase_support_services_manage"-->
<!--                        class="oe_highlight"/>-->
<!-- TODO 14 -->
                <field name="out_invoice_not_exceed_limit_state" widget="statusbar"
                       attrs="{'invisible':['|',('is_total_amount_exceed_limit','=',True),('move_type','!=','out_invoice')]}"/>
                <field name="out_invoice_exceed_limit_state" widget="statusbar"
                       attrs="{'invisible':['|',('is_total_amount_exceed_limit','=',False),('move_type','!=','out_invoice')]}"/>
            </xpath>
            <xpath expr="//field[@name='state']" position="replace">
                <field name="state" widget="statusbar" statusbar_visible="draft,posted"
                       attrs="{'invisible':[('move_type','=','out_invoice')]}"/>
            </xpath>


            <!--<xpath expr="//button[@name='action_invoice_open']" position="replace">-->
            <!--<button name="action_invoice_accountant_approval" class="oe_highlight"-->
            <!--type="object" states="draft" string="Approve Accountant"-->
            <!--groups="ejad_erp_account.group_accounting_employee"/>-->
            <!--<button name="action_invoice_open" class="oe_highlight"-->
            <!--type="object" states="accountant_approval" string="Confirm Financial Manager"-->
            <!--groups="ejad_erp_account.group_finance_verfifcation"/>-->
            <!--</xpath>-->
            <xpath expr="//button[@id='account_invoice_payment_btn']" position="replace">
                <button name="action_register_payment" type="object"
                        class="oe_highlight"
                        attrs="{'invisible': ['|', '|', ('state', '!=', 'posted'), ('payment_state', '!=', 'not_paid'), ('move_type', 'not in', ( 'out_refund', 'in_refund', 'out_receipt', 'in_receipt'))]}"
                        string="Register Payment" groups="account.group_account_invoice"/>
                <button name="action_register_payment" type="object"
                        class="oe_highlight"
                        attrs="{'invisible': ['|', '|', ('state', '!=', 'posted'), ('payment_state', '!=', 'not_paid'), ('move_type', 'not in', ( 'out_invoice'))]}"
                        string="Register Payment" groups="ejad_erp_account.group_customer_payment_register"/>
                <button name="action_register_payment" type="object"
                        class="oe_highlight"
                        attrs="{'invisible': ['|', '|', ('state', '!=', 'posted'), ('payment_state', '!=', 'not_paid'), ('move_type', 'not in', ( 'in_invoice'))]}"
                        string="Register Payment" groups="ejad_erp_account.group_supplier_payment_register"/>

            </xpath>
            <xpath expr="//page[last()]" position="after">

                <page string="خطاب المطالبة المالية" attrs="{'invisible':[('move_type', '!=', 'out_invoice')]}">
                    <group>
                        <field name="invoice_report_html" dir="rtl"/>
                        <field name="report_generated" invisible="1"/>

                    </group>
                </page>
            </xpath>
            <xpath expr="//page[1]//field[@name='invoice_line_ids']" position="before">

                <group>
                    <field attrs="{'invisible':[('move_type', '!=', 'out_invoice')]}" name="report"/>
                </group>
            </xpath>

            <xpath expr="//page[1]//field[@name='invoice_line_ids']" position="attributes">
                <attribute name="context">{'journal_id':journal_id, 'default_name':report}</attribute>

            </xpath>
            <xpath expr="//button[@name='preview_invoice']" position="replace">

                <button name="generate_html_invoice_report" string="توليد المطالبة المالية" type="object"
                        attrs="{'invisible':[('move_type', '!=', 'out_invoice')]}"
                        class="oe_highlight" groups="ejad_erp_account.group_generate_invoice_report"/>
                <button name="invoice_report_print" string="طباعة المطالبة المالية" type="object"
                        attrs="{'invisible':[('move_type', '!=', 'out_invoice')]}"
                        class="oe_highlight" groups="ejad_erp_account.group_print_invoice_report"/>

                <!--<button name="%(action_refund_invoice_report_wizard)d"-->
                <!--type="action"-->
                <!--string="طباعة نموذج استيراد الرسوم"-->
                <!--class="oe_stat_button oe_highlight"-->
                <!--attrs="{'invisible': [('move_type', '!=', 'out_refund')]}"-->
                <!--context="{-->
                <!--'default_invoice_id': active_id,-->

                <!--}"-->
                <!--/>-->

            </xpath>
            <xpath expr="//field[@name='invoice_payment_term_id']" position="after">
                <field name="refund_reason" attrs="{'invisible': [('move_type', '!=', 'out_refund')]}"/>
            </xpath>

        </field>
    </record>

</odoo>
